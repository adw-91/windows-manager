# WinManager Development Plan

**Date:** 2026-01-25
**Last Updated:** 2026-01-25
**Current Status:** Phase 2 Complete + UI Polish - Ready for Phase 3

---

## Session Continuity

> **For Claude:** Check `## Next Steps` section at the bottom for current task. Update status after completing each task. User will say "pick up where we left off" to continue.

---

## Architecture Decisions

### What to Keep from WinManager
- **Fallback chains** for system info (WMIC → PowerShell → platform module) - more robust than Admin App
- **Reusable widget components** (MetricTile, InfoTable, CollapsibleSection)
- **Service layer separation** - cleaner than Admin App's tab-coupled approach
- **Error handling patterns** in `windows_info.py`

### What to Port from Admin App (with improvements)
- **Threading abstractions** - but fix the signal blocking issue in LoopingWorker
- **pyqtgraph integration** - for real-time performance graphs
- **Concurrent data collection** - ThreadPoolExecutor for parallel WMI
- **Registry software queries** - but add caching and lazy loading

### New Approaches (Neither Project Has)
- **Loading states** - skeleton screens / "Loading..." placeholders
- **Cancellation tokens** - ability to abort long-running WMI queries
- **Ring buffer abstraction** - for graph data (memory efficient)
- **Result caching with async loading** - for slow-changing data (software, drivers, startups)
  - Load in background on startup (non-blocking UI)
  - Cache results in memory for instant display
  - Manual refresh button to reload
  - No TTL-based expiration (user-controlled refresh)

---

## Code Quality Standards

### Required for All New Code
1. **Error handling** with sensible defaults (no crashes on missing WMI properties)
2. **Loading indicators** for any async operation
3. **Proper cleanup** in closeEvent() for all tabs with workers
4. **Type hints** on public methods
5. **Docstrings** for classes and complex methods

### Threading Rules
1. Never block the UI thread with WMI/registry queries
2. Use SingleRunWorker for one-off data fetches
3. Use LoopingWorker for recurring metrics (with proper stop handling)
4. Always emit `finished` signal (don't block signals on stop)

---

## Implementation Phases

### Phase 1: Foundation (Infrastructure)

#### 1.1 Threading Module
Create `src/utils/thread_utils.py`:
- [x] **Task 1.1.1**: Signals class (QObject) with `finished`, `result`, `error` signals
- [x] **Task 1.1.2**: SingleRunWorker (QRunnable) for one-shot async tasks
- [x] **Task 1.1.3**: LoopingWorker (QThread) for recurring tasks - fix signal blocking issue
- [x] **Task 1.1.4**: Add unit tests for thread utilities

#### 1.2 Loading States Widget
Create `src/ui/widgets/loading_indicator.py`:
- [x] **Task 1.2.1**: LoadingOverlay widget (spinner + optional message)
- [x] **Task 1.2.2**: SkeletonRow widget for table placeholders
- [ ] **Task 1.2.3**: Integrate loading states into existing Overview tab

#### 1.3 Dark Theme
- [x] **Task 1.3.1**: Create `src/ui/theme.py` with color constants (no XML needed)
- [x] **Task 1.3.2**: Create `apply_dark_theme(app)` function using QPalette
- [x] **Task 1.3.3**: Apply theme in main.py at startup

#### 1.4 Dependencies
- [x] **Task 1.4.1**: Add pyqtgraph, numpy to requirements.txt
- [x] **Task 1.4.2**: Test imports work in venv

---

### Phase 2: Performance Monitoring

#### 2.1 Graph Widget
Create `src/ui/widgets/live_graph.py`:
- [x] **Task 2.1.1**: LiveGraph widget wrapping pyqtgraph PlotWidget
- [x] **Task 2.1.2**: Ring buffer data storage (configurable size, default 60 points)
- [x] **Task 2.1.3**: Auto-scaling Y axis with optional fixed range
- [x] **Task 2.1.4**: Styled to match dark theme

#### 2.2 Performance Service
Create `src/services/performance_monitor.py`:
- [x] **Task 2.2.1**: `get_cpu_times()` - returns user%, system%, idle%
- [x] **Task 2.2.2**: `get_context_switches()` - with rate calculation
- [x] **Task 2.2.3**: `get_interrupt_rate()` - interrupts per second
- [x] **Task 2.2.4**: `get_disk_io()` - read/write bytes per second
- [x] **Task 2.2.5**: `get_network_io()` - sent/recv bytes per second

#### 2.3 Performance Tab Implementation
Update `src/ui/tabs/performance_tab.py`:
- [x] **Task 2.3.1**: CPU graphs (3 graphs: user, system, idle)
- [x] **Task 2.3.2**: Context switch rate graph
- [x] **Task 2.3.3**: Sub-view navigation (sidebar with CPU/RAM/Disk/Network options)
- [x] **Task 2.3.4**: RAM view with memory breakdown graph
- [x] **Task 2.3.5**: Disk view with I/O graphs
- [x] **Task 2.3.6**: Network view with throughput graphs
- [x] **Task 2.3.7**: LoopingWorker integration for 500ms updates
- [x] **Task 2.3.8**: Proper cleanup on tab close

---

### Phase 3: System Data

#### 3.1 Async Data Loading Infrastructure
Create `src/services/data_cache.py`:
- [x] **Task 3.1.1**: DataCache class with generic caching for slow operations
- [x] **Task 3.1.2**: Background loading on app init (using SingleRunWorker)
- [x] **Task 3.1.3**: Thread-safe cache access
- [x] **Task 3.1.4**: Manual refresh trigger
- [x] **Task 3.1.5**: Loading state tracking (loading/loaded/error)

#### 3.2 Drivers Service (COMPLETED 2026-01-31)
Create `src/services/driver_info.py`:
- [x] **Task 3.2.1**: `get_all_drivers()` using Win32_SystemDriver
- [x] **Task 3.2.2**: Error handling for permission issues
- [x] **Task 3.2.3**: Background caching integration with DataCache
- [x] **Task 3.2.4**: Load on app startup asynchronously

#### 3.2b Drivers Tab (COMPLETED 2026-01-31)
Update `src/ui/tabs/drivers_tab.py`:
- [x] **Task 3.2b.1**: Table with columns: Name, Path, Status, Running, Start Type
- [x] **Task 3.2b.2**: Search/filter functionality
- [x] **Task 3.2b.3**: Loading state while fetching
- [x] **Task 3.2b.4**: Refresh button

#### 3.3 Installed Software Service
Create `src/services/software_info.py`:
- [x] **Task 3.3.1**: `get_installed_software()` from 3 registry paths (HKLM/HKCU Uninstall, HKLM Wow6432Node)
- [x] **Task 3.3.2**: Date parsing (YYYYMMDD format) and size formatting
- [x] **Task 3.3.3**: Result caching with manual refresh support
- [x] **Task 3.3.4**: Background loading on app startup (non-blocking)
- [x] **Task 3.3.5**: Sort by Name, Publisher, InstallDate, Size

#### 3.4 Software Section (Overview Tab)
Create full-featured table widget in CollapsibleSection:
- [x] **Task 3.4.1**: Create SoftwareTableWidget with QTableWidget
- [x] **Task 3.4.2**: Sortable columns (Name, Publisher, Version, Install Date, Size)
- [x] **Task 3.4.3**: Search/filter box with real-time filtering
- [x] **Task 3.4.4**: Loading state (SkeletonRows during initial load)
- [x] **Task 3.4.5**: Refresh button to manually reload data
- [x] **Task 3.4.6**: Async integration using SingleRunWorker

#### 3.5 Startup Apps Service & UI
Create `src/services/startup_info.py`:
- [x] **Task 3.5.1**: `get_startup_apps()` from registry Run/RunOnce keys (HKLM, HKCU)
- [x] **Task 3.5.2**: `get_task_scheduler_startups()` for scheduled tasks that run at logon
- [x] **Task 3.5.3**: `get_startup_folder_items()` from shell:startup folders
- [x] **Task 3.5.4**: `set_startup_enabled(name, enabled)` - enable/disable registry entries
- [x] **Task 3.5.5**: `add_startup_app(name, path, location)` - add new startup entry
- [x] **Task 3.5.6**: Result caching with background refresh

Update Startup Apps section in Overview:
- [x] **Task 3.5.7**: Create StartupAppsWidget with table and controls
- [x] **Task 3.5.8**: Columns: Enabled, Name, Command, Location, Type
- [x] **Task 3.5.9**: Enable/Disable toggle (checkbox)
- [x] **Task 3.5.10**: "Add" button to create new startup entry
- [x] **Task 3.5.11**: "Remove" button with confirmation dialog
- [x] **Task 3.5.12**: Loading state and async integration
- [x] **Task 3.5.13**: Admin elevation handling for system-level entries (warnings shown)

#### 3.6 Battery Information (Enhanced)
Create `src/services/battery_info.py` (powercfg-level detail):
- [ ] **Task 3.6.1**: `get_battery_status()` - percentage, charging state, time remaining
- [ ] **Task 3.6.2**: `get_battery_health()` - design capacity, full charge capacity, cycle count
- [ ] **Task 3.6.3**: `get_battery_report()` - recent usage, battery drain rates
- [ ] **Task 3.6.4**: `get_power_settings()` - active power plan, sleep settings
- [ ] **Task 3.6.5**: Parse battery data from WMI and PowerShell if available

Update Battery section in Overview (if battery detected):
- [ ] **Task 3.6.6**: Battery percentage gauge with status (Charging/Discharging/Full)
- [ ] **Task 3.6.7**: Time estimates (time remaining or time until full)
- [ ] **Task 3.6.8**: Health metrics: Design capacity vs. current, degradation %
- [ ] **Task 3.6.9**: Recent drain/charge rates and cycle count
- [ ] **Task 3.6.10**: Active power plan display
- [ ] **Task 3.6.11**: Auto-refresh every 30 seconds

#### 3.7 Hardware Components (Deferred to Phase 4+)
- [ ] **Task 3.7.1**: `get_hardware_components()` in windows_info.py using Win32_PnPEntity
- [ ] **Task 3.7.2**: Add to System tab as collapsible table
- [ ] **Task 3.7.3**: Filter by device class (optional)

---

### Phase 4: Windows Updates

#### 4.1 Updates Service
Create `src/services/update_info.py`:
- [ ] **Task 4.1.1**: `get_installed_updates()` via Windows Update Session API
- [ ] **Task 4.1.2**: `get_pending_updates()` for available updates
- [ ] **Task 4.1.3**: Error handling (COM errors, service not running)
- [ ] **Task 4.1.4**: Caching with TTL (check once per session)

#### 4.2 Updates UI
- [ ] **Task 4.2.1**: Add Updates section to System tab or new tab
- [ ] **Task 4.2.2**: Installed updates table
- [ ] **Task 4.2.3**: Available updates table with descriptions
- [ ] **Task 4.2.4**: Refresh button to re-check

---

### Phase 5: Processes & Services (COMPLETED 2026-01-31)

#### 5.1 Process Tab Enhancement
Update `src/ui/tabs/processes_tab.py`:
- [x] **Task 5.1.1**: Integrate existing ProcessManager service
- [x] **Task 5.1.2**: Process table with PID, Name, CPU%, Memory, Status
- [x] **Task 5.1.3**: Search/filter by name
- [x] **Task 5.1.4**: End process functionality (with confirmation)
- [x] **Task 5.1.5**: Auto-refresh toggle (LoopingWorker)
- [x] **Task 5.1.6**: Sort by any column

#### 5.2 Services Sub-tab
- [x] **Task 5.2.1**: `get_services()` method using Win32_Service
- [x] **Task 5.2.2**: Services table: Name, Display Name, Status, Start Type
- [x] **Task 5.2.3**: Start/Stop/Restart actions (with elevation handling)

---

### Phase 6: Polish & Advanced

#### 6.1 Concurrent Data Loading
- [ ] **Task 6.1.1**: Refactor Overview tab to use ThreadPoolExecutor
- [ ] **Task 6.1.2**: Parallel loading of all system info sections
- [ ] **Task 6.1.3**: Progress indication during initial load

#### 6.2 Settings/Preferences
- [ ] **Task 6.2.1**: Settings dialog (refresh intervals, theme toggle)
- [ ] **Task 6.2.2**: Persist settings to JSON file
- [ ] **Task 6.2.3**: Load settings on startup

#### 6.3 Future Features (Backlog)
- File System analysis (disk usage, large files)
- Network tab (speed monitoring, adapters)
- Security tab (BitLocker, encryption)
- Enterprise tab (domain info, group policy)

---

## Technical Reference

### Dependencies (requirements.txt)
```
PySide6>=6.6.0
psutil>=5.9.0
pywin32>=306
pyqtgraph>=0.13.0
numpy>=1.24.0
```

### Key Files to Reference
| Feature | Admin App Source | Purpose |
|---------|-----------------|---------|
| Threading | `utils/thread_utils.py` | Pattern reference (needs fixes) |
| Graphs | `utils/graph_generator.py` | pyqtgraph setup |
| WMI Queries | `utils/system_utils.py` | Query patterns |
| Performance | `ui/tabs/PerformanceTab.py` | Graph integration |

### Admin App Location
`C:\Users\adw91\Documents\Visual Studio Code\Projects\Admin App`

---

## Next Steps

### Current Phase: COMPLETE - All Core MMC Functionality Implemented
### Current Task: None - Application Feature-Complete

**Completed in Session (2026-01-31) - Major Milestone:**
All core Windows Manager MMC-equivalent functionality is now implemented:

1. ✓ **Process Management Tab** (Task Manager equivalent)
   - Full process list with PID, Name, CPU%, Memory, Status
   - Real-time search/filter by process name
   - End Task button with confirmation dialog
   - Auto-refresh toggle with 1000ms LoopingWorker updates
   - Sortable columns with numeric sorting for CPU/Memory

2. ✓ **Services Management Tab** (services.msc equivalent)
   - Full service list with Name, Display Name, Status, Start Mode, Path
   - Color-coded status (green for Running, amber for Stopped)
   - Start/Stop/Restart service controls
   - DataCache pattern for efficient loading
   - Search/filter functionality

3. ✓ **Drivers Tab** (Device Manager equivalent)
   - Full driver list with Name, Display Name, State, Start Mode, Path, Description
   - Search/filter across all fields
   - DataCache pattern with background loading
   - Loading overlay and skeleton rows

4. ✓ **System Tab** (msinfo32 equivalent)
   - System Information section: System Name, Manufacturer, Model, Domain
   - Hardware section: Processor, Memory, Disk, Network, BIOS
   - Operating System section: OS Version, Build, Architecture, Locale, Timezone
   - Collapsible sections with InfoTable display

5. ✓ **Enterprise Tab** (Active Directory equivalent)
   - Domain Information: domain name, DC, join status
   - Computer Information: name, workgroup, domain membership
   - Current User: username, domain, SID, admin status
   - Network: IP, adapter, DNS servers, IPv6
   - Azure AD: join status, tenant info, device info
   - Group Policy: GPO status, applied policies

**New Services Created:**
- `src/services/service_info.py` - Windows services management (WMI)
- `src/services/driver_info.py` - System drivers (WMI Win32_SystemDriver)
- `src/services/enterprise_info.py` - Domain/AD/network info (wmic, PowerShell, dsregcmd)

**Architecture Patterns Applied:**
- Singleton pattern with `get_<service>()` functions
- DataCache pattern for slow operations (services, drivers)
- SingleRunWorker for one-shot async tasks
- LoopingWorker for recurring updates (processes)
- LoadingOverlay and skeleton rows for loading states
- Dark theme Colors class throughout

**Application Status: FEATURE COMPLETE**
The Windows Manager now combines functionality of:
- Task Manager (processes)
- services.msc (services management)
- Device Manager (drivers)
- System Information (msinfo32)
- Active Directory tools (enterprise info)

**Optional Future Enhancements:**
- Battery Information (Task 3.6) - if battery detected
- Event Viewer integration
- Registry Editor
- File System analysis
- Network adapter management

---

## Progress Log

| Date | Task | Status | Notes |
|------|------|--------|-------|
| 2026-01-25 | Plan created | Complete | Initial feature analysis |
| 2026-01-25 | Task 1.1.1-1.1.4 | Complete | Threading module with tests (9 tests passing) |
| 2026-01-25 | Task 1.2.1-1.2.2 | Complete | Loading indicators (spinner, skeleton, overlay) |
| 2026-01-25 | Task 1.3.1-1.3.3 | Complete | Dark theme with Colors class and stylesheet |
| 2026-01-25 | Task 1.4.1-1.4.2 | Complete | pyqtgraph 0.14.0, numpy 2.4.1 installed |
| 2026-01-25 | Task 2.1.1-2.1.4 | Complete | LiveGraph widget with RingBuffer, dark theme styling |
| 2026-01-25 | Task 2.2.1-2.2.5 | Complete | PerformanceMonitor service with differential rate calc |
| 2026-01-25 | Task 2.3.1-2.3.8 | Complete | Full Performance Tab with CPU/Memory/Disk/Network views |
| 2026-01-25 | UX Improvement | Complete | Replaced Performance Tab with expandable metric tiles on Overview |
| 2026-01-25 | Detail Panels | Complete | Added Task Manager-style details grid to expanded tiles |
| 2026-01-25 | Layout Redesign | Complete | 4x1 tiles, system header with hostname, collapsible sections |
| 2026-01-25 | UI Polish | Complete | Compact tiles, full-width expand, start at min width |
| 2026-01-25 | Plan Clarifications | Complete | Updated Phase 3 with enhanced requirements for software/startup/battery |
| 2026-01-25 | Task 3.1.1-3.1.5 | Complete | DataCache infrastructure with background loading, thread-safe access |
| 2026-01-25 | Task 3.3.1-3.3.5 | Complete | SoftwareInfo service with 3 registry paths, 83 apps detected |
| 2026-01-25 | Task 3.4.1-3.4.6 | Complete | SoftwareTableWidget with 9 columns, search, sort, manual resize |
| 2026-01-25 | Task 3.5.1-3.5.13 | Complete | StartupAppsWidget with enable/disable, add/remove, 33 items detected |
| 2026-01-31 | Task 5.1.1-5.1.6 | Complete | Process Management Tab - full Task Manager functionality |
| 2026-01-31 | Task 5.2.1-5.2.3 | Complete | Services Management Tab - services.msc equivalent |
| 2026-01-31 | Task 3.2.1-3.2b.4 | Complete | Drivers Tab - Device Manager equivalent |
| 2026-01-31 | System Tab | Complete | Full system info with CollapsibleSections and InfoTables |
| 2026-01-31 | Enterprise Tab | Complete | Domain, AD, Azure AD, GPO, Network info |
| 2026-01-31 | service_info.py | Complete | Windows services service with WMI |
| 2026-01-31 | driver_info.py | Complete | System drivers service with WMI |
| 2026-01-31 | enterprise_info.py | Complete | Enterprise/domain info service |
| 2026-01-31 | **MILESTONE** | **COMPLETE** | **All core MMC functionality implemented** |

